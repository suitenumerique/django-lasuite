# Using malware detection backend

If you are developing a service where users can upload files, you will probably want to check if these files are safe or not.

The malware detection app is here to give you several backend implementations and others can be added to match your requirements.

## Global idea

A backend should inherit from `lasuite.malware_detection.backends.base.BaseBackend` class and implements the abstract methods declare in it.
The backend service then is responsible to analyse the file and give an answer by calling a defined callback.

### Abstract methods

- `def analyse_file(self, file_path: str, **kwargs) -> None:`: it is the entrypoint to analyse a file. This method return nothing and can analyse the file by using a celery task. The parameters to use:
    - `file_path`: the path to access the file. This path must be accessible with the django default storage.
    - `kwargs`: arbitrary kwargs usuqble by the user using the library. These kwargs will be used by the callback. You can for example pass a resource id or whatever usefull for you.

### Callback

The settings `MALWARE_DETECTION_CALLBACK` defined a function (full module with dot to the function). This function receives these parameters:
    - `file_path` the `file_path` used in the `analyse_file` method
    - `status` the analysis status (see `lasuite.malware_detection.enums.ReportStatus`). It can be `safe`, `unsafe` and `unknown`. In case of `unknwon` you are responsible to determine what you should do
    - `error_info` a dict containing a `error` and `error_code` properties.
    - `kwargs` the kwargs you pass to the `analyse_file` method

## Existing implementations

### Dummy

The `dummy` backend does nothing. It calls the `callback` with always the `safe` status. It can be usefull in a test contest or to deactivate analysis.

### JCOP

`JCOP` means for [Je Clique Ou Pas](https://jecliqueoupas.cyber.gouv.fr/accueil). To use it you need the url and the api token provided by them.

The settings you have to define:

- `MALWARE_DETECTION_JCOP_API_KEY`: The API key provided by JCOP
- `MALWARE_DETECTION_JCOP_BASE_URL`: The base URL provided by JCOP (including the `/api/v1` base path)

The optional settings you can define:

- `MALWARE_DETECTION_JCOP_RESULT_TIMEOUT`: The timeout for the result request. Default: 30
- `MALWARE_DETECTION_JCOP_SUBMIT_TIMEOUT`: The timeout for the submit request. Default: 600   

